# Iteration 2 - Cross-Audit #1: Deep Dive into Validated Issues

## –î–∞—Ç–∞
2025-10-01

## –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
–í–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≥–∏–ø–æ—Ç–µ–∑—ã –∏–∑ Audit #1:
- **H2.2** - Zero-volume 48.3% (expected 2.4%)
- **H2.3** - Zero-interval 19.5% (duplicate timestamps)
- **H2.4** - Warmup logging broken (only "1/10")

## –¶–µ–ª—å –∫—Ä–æ—Å—Å-–∞—É–¥–∏—Ç–∞
–£–≥–ª—É–±–∏—Ç—å—Å—è –≤ –ø—Ä–∏—á–∏–Ω—ã –∫–∞–∂–¥–æ–π –ø—Ä–æ–±–ª–µ–º—ã –∏ –Ω–∞–π—Ç–∏ –ö–û–†–ù–ï–í–´–ï –ü–†–ò–ß–ò–ù–´.

---

## Deep Dive: H2.2 - Zero-Volume Candles

### –ò—Å—Ö–æ–¥–Ω–∞—è –≥–∏–ø–æ—Ç–µ–∑–∞
48.3% —Å–≤–µ—á–µ–π –∏–º–µ—é—Ç –Ω—É–ª–µ–≤–æ–π volume –≤–º–µ—Å—Ç–æ –æ–∂–∏–¥–∞–µ–º—ã—Ö 2.4%

### –í–æ–ø—Ä–æ—Å—ã –¥–ª—è —É–≥–ª—É–±–ª–µ–Ω–∏—è

#### Q2.2.1: –ü–æ—á–µ–º—É low-activity coins –ø—Ä–æ—Ö–æ–¥—è—Ç volume —Ñ–∏–ª—å—Ç—Ä?

**–ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞** - trading_api.py (–Ω—É–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å):
```python
# config.py:11
MIN_DAILY_VOLUME = 80000000  # 80M

# trading_api.py - –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è?
def get_all_symbols_by_volume():
    # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ MIN_DAILY_VOLUME
```

**–ì–∏–ø–æ—Ç–µ–∑–∞ C2.1**: Volume —Ñ–∏–ª—å—Ç—Ä —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
- Bybit API –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –æ–±—ä–µ–º –∑–∞ 24 —á–∞—Å–∞
- –ù–æ —Ñ–∏–ª—å—Ç—Ä –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å–ø–æ—Ç–æ–≤—ã–π volume –≤–º–µ—Å—Ç–æ futures
- –ò–ª–∏ volume –≤  USDT –≤–º–µ—Å—Ç–æ –Ω–∞—Ç–∏–≤–Ω–æ–π –≤–∞–ª—é—Ç—ã

**–í–∞–ª–∏–¥–∞—Ü–∏—è**: –ü—Ä–æ—á–∏—Ç–∞—Ç—å trading_api.py –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º—É–ª—É —Ä–∞—Å—á–µ—Ç–∞

#### Q2.2.2: –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è zero-volume —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º —Å—É—Ç–æ–∫?

**–ù–∞–±–ª—é–¥–µ–Ω–∏–µ –∏–∑ –ª–æ–≥–æ–≤**:
```
Test ran: 04:29 - 04:33 (UTC)
```

**–ì–∏–ø–æ—Ç–µ–∑–∞ C2.2**: Low-activity –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫
- –≠—Ç–æ —Ä–∞–Ω–Ω–µ–µ —É—Ç—Ä–æ –ø–æ –ï–≤—Ä–æ–ø–µ/–°–®–ê
- –ê–∑–∏–∞—Ç—Å–∫–∞—è —Å–µ—Å—Å–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω–µ–µ –∞–∫—Ç–∏–≤–Ω–æ–π –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–æ–Ω–µ—Ç

**–í–∞–ª–∏–¥–∞—Ü–∏—è**: –°—Ä–∞–≤–Ω–∏—Ç—å zero-volume % –≤ —Ä–∞–∑–Ω–æ–µ –≤—Ä–µ–º—è —Å—É—Ç–æ–∫

#### Q2.2.3: Forward-fill vs real zero-volume?

**–í–æ–ø—Ä–æ—Å**: 48.3% - —ç—Ç–æ –≤—Å–µ forward-fill –∏–ª–∏ –µ—Å—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã –±–µ–∑ —Ç—Ä–µ–π–¥–æ–≤?

**–ì–∏–ø–æ—Ç–µ–∑–∞ C2.3**: Forward-fill —Å–æ–∑–¥–∞–µ—Ç—Å—è –∏–∑–±—ã—Ç–æ—á–Ω–æ
- Timer —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–∞–∂–¥—ã–µ 10s
- –î–∞–∂–µ –µ—Å–ª–∏ –Ω–µ—Ç —Ç—Ä–µ–π–¥–æ–≤, —Å–æ–∑–¥–∞–µ—Ç—Å—è forward-fill —Å–≤–µ—á–∞
- –ù–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –º–æ–Ω–µ—Ç—ã –º–æ–≥—É—Ç –Ω–µ –∏–º–µ—Ç—å —Ç—Ä–µ–π–¥–æ–≤ –ø–æ 51 –∏–Ω—Ç–µ—Ä–≤–∞–ª –ø–æ–¥—Ä—è–¥!

**–ö–æ–¥ –∞–Ω–∞–ª–∏–∑** (websocket_handler.py:304-313):
```python
elif current_data['last_close_price'] is not None:
    # No trades for this period - forward-fill with last price
    completed_candle = {
        'timestamp': boundary,
        'open': current_data['last_close_price'],
        'high': current_data['last_close_price'],
        'low': current_data['last_close_price'],
        'close': current_data['last_close_price'],
        'volume': 0
    }
```

**–í—ã–≤–æ–¥**: Forward-fill –ü–†–ê–í–ò–õ–¨–ù–´–ô –º–µ—Ö–∞–Ω–∏–∑–º, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –º–æ–Ω–µ—Ç —Å –∫—Ä–∞–π–Ω–µ –Ω–∏–∑–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é.

---

## Deep Dive: H2.3 - Zero-Interval Candles

### –ò—Å—Ö–æ–¥–Ω–∞—è –≥–∏–ø–æ—Ç–µ–∑–∞
19.5% –ø–∞—Ä —Å–≤–µ—á–µ–π –∏–º–µ—é—Ç interval = 0ms (duplicate timestamp)

### –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞

**–ê–Ω–∞–ª–∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ –∏–∑ Test #3**:
```
Prev: timestamp=X, volume=4007700 (real candle)
Curr: timestamp=X, volume=0 (forward-fill with SAME timestamp!)
```

**–ö–æ–¥ –∞–Ω–∞–ª–∏–∑** - finalization timer —Å–æ–∑–¥–∞–µ—Ç –î–í–ï —Å–≤–µ—á–∏ —Å –æ–¥–Ω–∏–º timestamp:

1. **–ü–µ—Ä–≤–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è** (boundary = X):
   - –ï—Å—Ç—å —Ç—Ä–µ–π–¥—ã ‚Üí —Å–æ–∑–¥–∞–µ—Ç—Å—è real candle —Å timestamp=X
   - log_new_candle(candle —Å timestamp=X)
   - boundary += 10000

2. **–°–ª–µ–¥—É—é—â–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è** (boundary = X + 10000):
   - –ù–µ—Ç —Ç—Ä–µ–π–¥–æ–≤ ‚Üí —Å–æ–∑–¥–∞–µ—Ç—Å—è forward-fill —Å timestamp=X+10000
   - log_new_candle(candle —Å timestamp=X+10000)

**–ù–û –ü–†–û–ë–õ–ï–ú–ê**:
–°–º–æ—Ç—Ä–∏–º –∫–æ–¥ websocket_handler.py:287-328:

```python
while boundary < current_boundary:
    trades_for_boundary = self._trades_by_interval[symbol].get(boundary, [])
    if trades_for_boundary:
        # Create real candle
        completed_candle = create_candle_from_trades(trades_for_boundary, boundary)
        # ...
        del self._trades_by_interval[symbol][boundary]  # Remove processed

    elif current_data['last_close_price'] is not None:
        # Forward-fill
        completed_candle = {..., 'timestamp': boundary}

    # Append to buffer
    self.candles_buffer[symbol].append(completed_candle)

    # LOG HERE - correct timestamp
    log_new_candle(symbol, completed_candle)

    # Move forward
    boundary += candle_interval_ms
```

**–í—ã–≤–æ–¥**: –ö–æ–¥ –ü–†–ê–í–ò–õ–¨–ù–´–ô! –ö–∞–∂–¥–∞—è —Å–≤–µ—á–∞ –¥–æ–ª–∂–Ω–∞ –∏–º–µ—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π timestamp.

### –ù–æ–≤–∞—è –≥–∏–ø–æ—Ç–µ–∑–∞ C2.4: Logger –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –î–í–ê –†–ê–ó–ê –¥–ª—è –æ–¥–Ω–æ–π —Å–≤–µ—á–∏

**–í–æ–∑–º–æ–∂–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞**:
1. log_new_candle –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ finalization timer
2. –ù–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –µ—â—ë –æ–¥–∏–Ω –≤—ã–∑–æ–≤ –∏–∑ –¥—Ä—É–≥–æ–≥–æ –º–µ—Å—Ç–∞?

**–ì–∏–ø–æ—Ç–µ–∑–∞ C2.4**: Race condition - –¥–≤–µ –∑–∞–¥–∞—á–∏ –≤—ã–∑—ã–≤–∞—é—Ç log_new_candle
- finalization_timer —Å–æ–∑–¥–∞–µ—Ç —Å–≤–µ—á—É
- –ö–∞–∫–∞—è-—Ç–æ –¥—Ä—É–≥–∞—è –ª–æ–≥–∏–∫–∞ –¢–û–ñ–ï –ª–æ–≥–∏—Ä—É–µ—Ç —Ç—É –∂–µ —Å–≤–µ—á—É

**–í–∞–ª–∏–¥–∞—Ü–∏—è**: Grep –∫–æ–¥ –¥–ª—è "log_new_candle" - —Å–∫–æ–ª—å–∫–æ –≤—ã–∑–æ–≤–æ–≤?

---

## Deep Dive: H2.4 - Warmup Logging

### –ò—Å—Ö–æ–¥–Ω–∞—è –≥–∏–ø–æ—Ç–µ–∑–∞
Warmup logging –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –Ω–∞ "1/10"

### –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞

**–ö–æ–¥ –∞–Ω–∞–ª–∏–∑** (main.py:139-142):
```python
if warmup_active and min_candles != float('inf'):
    if min_candles - last_warmup_log >= 10 or (min_candles == 1 and last_warmup_log == 0):
        log_warmup_progress(min_candles, WARMUP_INTERVALS)
        last_warmup_log = min_candles
```

**–õ–æ–≥–∏–∫–∞**:
- –ü—Ä–∏ min_candles=1 –∏ last_warmup_log=0 ‚Üí LOG "1/10", set last_warmup_log=1
- –ü—Ä–∏ min_candles=2-10 ‚Üí –ù–ï–¢ –õ–û–ì–ê (—Ä–∞–∑–Ω–∏—Ü–∞ <10)
- –ü—Ä–∏ min_candles=11 ‚Üí LOG "11/10" –ù–û warmup —É–∂–µ –∑–∞–≤–µ—Ä—à–µ–Ω!

**–ü—Ä–æ–±–ª–µ–º–∞**: –£—Å–ª–æ–≤–∏–µ `min_candles - last_warmup_log >= 10` —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ –¥–ª—è WARMUP_INTERVALS=10.

### –ì–∏–ø–æ—Ç–µ–∑–∞ C2.5: Warmup logging –∏–Ω—Ç–µ—Ä–≤–∞–ª –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω –¥–ª—è WARMUP_INTERVALS=10

**–û–∂–∏–¥–∞–Ω–∏–µ**: –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–µ 1-2 —Å–≤–µ—á–∏ –∏–ª–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏
**–†–µ–∞–ª—å–Ω–æ—Å—Ç—å**: –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ +10 —Å–≤–µ—á–µ–π

**–í–∞–ª–∏–¥–∞—Ü–∏—è**: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –Ω–∞ `>= 1` –≤–º–µ—Å—Ç–æ `>= 10` –∏ –ø–µ—Ä–µ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

---

## –ù–æ–≤—ã–µ –≥–∏–ø–æ—Ç–µ–∑—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### üî¥ C2.1 - Volume Filter Miscalculation
**–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ**: MIN_DAILY_VOLUME —Ñ–∏–ª—å—Ç—Ä —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
**–ò—Å—Ç–æ—á–Ω–∏–∫**: 82.6% zero-volume —É FARTCOINUSDT –ø—Ä–∏ MIN=80M
**–í–∞–ª–∏–¥–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å trading_api.py –∏ —Ä–µ–∞–ª—å–Ω—ã–π volume –∏–∑ Bybit API

### ‚ö†Ô∏è C2.2 - Time-of-Day Correlation
**–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ**: Zero-volume –∫–æ—Ä—Ä–µ–ª–∏—Ä—É–µ—Ç —Å –≤—Ä–µ–º–µ–Ω–µ–º —Å—É—Ç–æ–∫ (04:29 UTC = low activity)
**–ò—Å—Ç–æ—á–Ω–∏–∫**: –¢–µ—Å—Ç—ã –∑–∞–ø—É—â–µ–Ω—ã –≤ —Ä–∞–Ω–Ω–µ–µ —É—Ç—Ä–æ
**–í–∞–ª–∏–¥–∞—Ü–∏—è**: –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Ç–µ—Å—Ç—ã –≤ —Ä–∞–∑–Ω–æ–µ –≤—Ä–µ–º—è —Å—É—Ç–æ–∫

### üî¥ C2.3 - Excessive Forward-Fill for Low-Activity Coins
**–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ**: Forward-fill —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –Ω–æ –º–æ–Ω–µ—Ç—ã —Å –Ω–∏–∑–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é –Ω–µ –¥–æ–ª–∂–Ω—ã –±—ã–ª–∏ –ø—Ä–æ–π—Ç–∏ —Ñ–∏–ª—å—Ç—Ä
**–ò—Å—Ç–æ—á–Ω–∏–∫**: 51 consecutive zero-volume candles = 510 —Å–µ–∫—É–Ω–¥ –±–µ–∑ —Ç—Ä–µ–π–¥–æ–≤
**–í–∞–ª–∏–¥–∞—Ü–∏—è**: –°–≤—è–∑–∞–Ω–æ —Å C2.1

### üî¥ C2.4 - Double Logging Race Condition
**–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ**: log_new_candle –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã –¥–ª—è –æ–¥–Ω–æ–π —Å–≤–µ—á–∏
**–ò—Å—Ç–æ—á–Ω–∏–∫**: 19.5% duplicate timestamps
**–í–∞–ª–∏–¥–∞—Ü–∏—è**: Grep "log_new_candle" –≤ –∫–æ–¥–µ + –¥–æ–±–∞–≤–∏—Ç—å debug logging

### ‚ö†Ô∏è C2.5 - Warmup Logging Interval Too Large
**–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ**: –£—Å–ª–æ–≤–∏–µ `>= 10` —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ –¥–ª—è WARMUP_INTERVALS=10
**–ò—Å—Ç–æ—á–Ω–∏–∫**: –¢–æ–ª—å–∫–æ 1 –ª–æ–≥ –≤–º–µ—Å—Ç–æ ~10
**–í–∞–ª–∏–¥–∞—Ü–∏—è**: –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ `>= 1` –∏ –ø–µ—Ä–µ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

---

## –ü–ª–∞–Ω –≤–∞–ª–∏–¥–∞—Ü–∏–∏ Cross-Audit #1

1. **Read trading_api.py** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å volume —Ñ–∏–ª—å—Ç—Ä (C2.1)
2. **Grep log_new_candle** - –Ω–∞–π—Ç–∏ –≤—Å–µ –≤—ã–∑–æ–≤—ã (C2.4)
3. **Test C2.5** - –ø—Ä–æ—Å—Ç–æ–π —Ñ–∏–∫—Å –≤ main.py logging condition
4. **Analyze C2.2** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å timestamp —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ zero-volume —Å–≤–µ—á–µ–π

---

## –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

**–í–∞–ª–∏–¥–Ω—ã–µ –≥–∏–ø–æ—Ç–µ–∑—ã** (–ø—Ä–æ–≥–Ω–æ–∑):
- C2.1 (Volume filter) - –í—ã—Å–æ–∫–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å
- C2.4 (Double logging) - –í—ã—Å–æ–∫–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å
- C2.5 (Warmup interval) - 100% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å (–æ—á–µ–≤–∏–¥–Ω–æ –∏–∑ –∫–æ–¥–∞)

**–°–æ–º–Ω–∏—Ç–µ–ª—å–Ω—ã–µ**:
- C2.2 (Time-of-day) - –¢—Ä–µ–±—É–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- C2.3 (Excessive forward-fill) - –°–ª–µ–¥—Å—Ç–≤–∏–µ C2.1

**–¶–µ–ª—å**: –ú–∏–Ω–∏–º—É–º 3 –≤–∞–ª–∏–¥–Ω—ã—Ö –≥–∏–ø–æ—Ç–µ–∑—ã –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –∫—Ä–æ—Å—Å-–∞—É–¥–∏—Ç–æ–≤.
